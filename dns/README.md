## メモ

- ドメイン名：サーバを識別するための情報としてIPアドレスがある
    - IPアドレスは人間には読めないので、人間に読みやすい形に直したものがドメイン
- 名前解決：ドメイン名からIPアドレスを決定すること
- Route53：ドメイン取得を代行してくれるサービス
- パブリックDNSとプライベートDNS
    - パブリック：パブリックに公開しているサーバ（Webサーバやロードバランサなど）のドメイン名を名前解決する
        - パブリックIPを返してくれる
    - プライベート：システム内部でのみ参照されることを前提としたサーバ（データベースなど）を名前解決する
        - ドメインの取得は不要
- トップレベルドメイン（TLD）
    - `.com`,`.jp`とか。固有の名称＋TLDの組み合わせでドメインが構成されるのが普通
- ドメインを取得したら
    - パブリックDNSが同時に作成される
    - ここに、踏み台サーバとロードバランサを紐付ける
- パブリックDNSにリソースを追加する手順
    - ホストゾーンの画面にいく（Route53でドメインを作ると自動でゾーンも作成されるっぽい）
    - ルーティングポリシー→シンプルルーティング（とりあえずおまじないとして覚えておく）
    - レコードタイプ：IPアドレスを指定したいので「A」を選ぶ
    - 値／トラフィックルーティングの先：EC2インスタンスに割り当てられたIPアドレスを書く（bastionのIPアドレス）
        - 間違ってもプライベートの方は記入しない
    - クイック作成とウィザード作成の2つの画面があるんだ、:he-:
        - ルーティング先をAWSリソースにしたい場合、ウィザード作成の画面からしかできなさそう
- 接続確認コマンド： `nslookup`
    - `dig`もある、こっちの方が高機能なコマンド
- プライベートDNSの作成手順
    - VPC内部のリソースに、IPアドレスではなくわかりやすい名前でアクセスできるようにするために設定する
    - 世の中にすでに存在するパブリックなドメイン名と被らないように注意が必要
    - 複数のVPCをまたいで利用はできない、1つのVPCのみ
    - プライベートDNSが使えるか、VPCで確認する
        - 以下2つが有効になっているかをみる、なっていなければする
            - DNSホスト名
            - DNS解決
    - ホストゾーン作成する画面で、「プライベートホストゾーン」を選ぶ
        - 関連するVPCの情報を入力する
    - EC2へのルーティングを設定する
        - ここではプライベートのIPを指定する
    - RDSへのルーティングを設定する
        - RDSの「エンドポイント」を指定する
        - レコードタイプはエンドポイントを指定できる「CNAME」
    - 動作確認は踏み台サーバ上で行なう
        - 踏み台サーバにSSH接続→`nslookup`コマンドを実行する
- 証明書発行
    - 検証に「DNS検証」を選んでいるので、申請した後、Route53でのレコード作成が必要
        - 検証：証明書の申請者の身分をAWSが検証する
- 証明書が発行されると、HTTPSでの通信が可能になる
    - ロードバランサのリスナに追加できるようになるので、する
